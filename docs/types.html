<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>The R in Spark: Learning Apache Spark with R</title>
  <meta name="description" content="A book to learn Apache Spark with R using the sparklyr R package.">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="The R in Spark: Learning Apache Spark with R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A book to learn Apache Spark with R using the sparklyr R package." />
  <meta name="github-repo" content="javierluraschi/the-r-in-spark" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="The R in Spark: Learning Apache Spark with R" />
  
  <meta name="twitter:description" content="A book to learn Apache Spark with R using the sparklyr R package." />
  

<meta name="author" content="Javier Luraschi">


<meta name="date" content="2018-10-08">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="overview-3.html">
<link rel="next" href="troubleshooting.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-1.2/htmlwidgets.js"></script>
<script src="libs/r2d3-render-0.1.0/r2d3-render.js"></script>
<script src="libs/webcomponents-2.0.0/webcomponents.js"></script>
<script src="libs/r2d3-binding-0.2.2/r2d3.js"></script>
<script src="libs/d3v5-5.0.0/d3.min.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-119986300-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-119986300-1');
</script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><strong><a href="./">Learning Apache Spark with R</a></strong></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="why.html"><a href="why.html"><i class="fa fa-check"></i>Why</a></li>
<li class="chapter" data-level="" data-path="structure.html"><a href="structure.html"><i class="fa fa-check"></i>Structure</a></li>
<li class="chapter" data-level="" data-path="authors.html"><a href="authors.html"><i class="fa fa-check"></i>Authors</a></li>
<li class="chapter" data-level="" data-path="acknowledgments.html"><a href="acknowledgments.html"><i class="fa fa-check"></i>Acknowledgments</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="intro-background.html"><a href="intro-background.html"><i class="fa fa-check"></i><b>1.1</b> Background</a></li>
<li class="chapter" data-level="1.2" data-path="spark.html"><a href="spark.html"><i class="fa fa-check"></i><b>1.2</b> Spark</a></li>
<li class="chapter" data-level="1.3" data-path="r.html"><a href="r.html"><i class="fa fa-check"></i><b>1.3</b> R</a></li>
<li class="chapter" data-level="1.4" data-path="sparklyr.html"><a href="sparklyr.html"><i class="fa fa-check"></i><b>1.4</b> sparklyr</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="starting.html"><a href="starting.html"><i class="fa fa-check"></i><b>2</b> Getting Started</a><ul>
<li class="chapter" data-level="2.1" data-path="prerequisites.html"><a href="prerequisites.html"><i class="fa fa-check"></i><b>2.1</b> Prerequisites</a><ul>
<li class="chapter" data-level="2.1.1" data-path="prerequisites.html"><a href="prerequisites.html#install-r"><i class="fa fa-check"></i><b>2.1.1</b> Install R</a></li>
<li class="chapter" data-level="2.1.2" data-path="prerequisites.html"><a href="prerequisites.html#install-java"><i class="fa fa-check"></i><b>2.1.2</b> Install Java</a></li>
<li class="chapter" data-level="2.1.3" data-path="prerequisites.html"><a href="prerequisites.html#install-rstudio"><i class="fa fa-check"></i><b>2.1.3</b> Install RStudio</a></li>
<li class="chapter" data-level="2.1.4" data-path="prerequisites.html"><a href="prerequisites.html#install-sparklyr"><i class="fa fa-check"></i><b>2.1.4</b> Install sparklyr</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="installing-spark.html"><a href="installing-spark.html"><i class="fa fa-check"></i><b>2.2</b> Installing Spark</a></li>
<li class="chapter" data-level="2.3" data-path="connecting-to-spark.html"><a href="connecting-to-spark.html"><i class="fa fa-check"></i><b>2.3</b> Connecting to Spark</a></li>
<li class="chapter" data-level="2.4" data-path="using-spark.html"><a href="using-spark.html"><i class="fa fa-check"></i><b>2.4</b> Using Spark</a><ul>
<li class="chapter" data-level="2.4.1" data-path="using-spark.html"><a href="using-spark.html#spark-web-interface"><i class="fa fa-check"></i><b>2.4.1</b> Web Interface</a></li>
<li class="chapter" data-level="2.4.2" data-path="using-spark.html"><a href="using-spark.html#logs"><i class="fa fa-check"></i><b>2.4.2</b> Logs</a></li>
<li class="chapter" data-level="2.4.3" data-path="using-spark.html"><a href="using-spark.html#using-spark-from-rstudio"><i class="fa fa-check"></i><b>2.4.3</b> RStudio</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="disconnecting.html"><a href="disconnecting.html"><i class="fa fa-check"></i><b>2.5</b> Disconnecting</a></li>
<li class="chapter" data-level="2.6" data-path="recap.html"><a href="recap.html"><i class="fa fa-check"></i><b>2.6</b> Recap</a></li>
</ul></li>
<li class="part"><span><b>I Analysis</b></span></li>
<li class="chapter" data-level="3" data-path="analysis.html"><a href="analysis.html"><i class="fa fa-check"></i><b>3</b> Analysis</a><ul>
<li class="chapter" data-level="3.1" data-path="overview.html"><a href="overview.html"><i class="fa fa-check"></i><b>3.1</b> Overview</a></li>
<li class="chapter" data-level="3.2" data-path="dplyr.html"><a href="dplyr.html"><i class="fa fa-check"></i><b>3.2</b> dplyr</a><ul>
<li class="chapter" data-level="3.2.1" data-path="dplyr.html"><a href="dplyr.html#pass-through-functions"><i class="fa fa-check"></i><b>3.2.1</b> Pass-through Functions</a></li>
<li class="chapter" data-level="3.2.2" data-path="dplyr.html"><a href="dplyr.html#dplyr-reosurces"><i class="fa fa-check"></i><b>3.2.2</b> Resources</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="dbi.html"><a href="dbi.html"><i class="fa fa-check"></i><b>3.3</b> DBI</a></li>
</ul></li>
<li class="part"><span><b>II Modeling</b></span></li>
<li class="chapter" data-level="4" data-path="modeling.html"><a href="modeling.html"><i class="fa fa-check"></i><b>4</b> Modeling</a><ul>
<li class="chapter" data-level="4.1" data-path="overview-1.html"><a href="overview-1.html"><i class="fa fa-check"></i><b>4.1</b> Overview</a></li>
<li class="chapter" data-level="4.2" data-path="supervised.html"><a href="supervised.html"><i class="fa fa-check"></i><b>4.2</b> Supervised</a></li>
<li class="chapter" data-level="4.3" data-path="unsupervised.html"><a href="unsupervised.html"><i class="fa fa-check"></i><b>4.3</b> Unsupervised</a><ul>
<li class="chapter" data-level="4.3.1" data-path="unsupervised.html"><a href="unsupervised.html#k-means-clustering"><i class="fa fa-check"></i><b>4.3.1</b> K-Means Clustering</a></li>
<li class="chapter" data-level="4.3.2" data-path="unsupervised.html"><a href="unsupervised.html#gaussian-mixture-clustering"><i class="fa fa-check"></i><b>4.3.2</b> Gaussian Mixture Clustering</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="broom.html"><a href="broom.html"><i class="fa fa-check"></i><b>4.4</b> Broom</a></li>
<li class="chapter" data-level="4.5" data-path="pipelines.html"><a href="pipelines.html"><i class="fa fa-check"></i><b>4.5</b> Pipelines</a></li>
</ul></li>
<li class="part"><span><b>III Scaling</b></span></li>
<li class="chapter" data-level="5" data-path="clusters.html"><a href="clusters.html"><i class="fa fa-check"></i><b>5</b> Clusters</a><ul>
<li class="chapter" data-level="5.1" data-path="overview-2.html"><a href="overview-2.html"><i class="fa fa-check"></i><b>5.1</b> Overview</a></li>
<li class="chapter" data-level="5.2" data-path="managers.html"><a href="managers.html"><i class="fa fa-check"></i><b>5.2</b> Managers</a><ul>
<li class="chapter" data-level="5.2.1" data-path="managers.html"><a href="managers.html#clusters-standalone"><i class="fa fa-check"></i><b>5.2.1</b> Standalone</a></li>
<li class="chapter" data-level="5.2.2" data-path="managers.html"><a href="managers.html#yarn"><i class="fa fa-check"></i><b>5.2.2</b> Yarn</a></li>
<li class="chapter" data-level="5.2.3" data-path="managers.html"><a href="managers.html#mesos"><i class="fa fa-check"></i><b>5.2.3</b> Mesos</a></li>
<li class="chapter" data-level="5.2.4" data-path="managers.html"><a href="managers.html#kubernetes"><i class="fa fa-check"></i><b>5.2.4</b> Kubernetes</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="on-premise.html"><a href="on-premise.html"><i class="fa fa-check"></i><b>5.3</b> On-Premise</a><ul>
<li class="chapter" data-level="5.3.1" data-path="on-premise.html"><a href="on-premise.html#cloudera"><i class="fa fa-check"></i><b>5.3.1</b> Cloudera</a></li>
<li class="chapter" data-level="5.3.2" data-path="on-premise.html"><a href="on-premise.html#hortonworks"><i class="fa fa-check"></i><b>5.3.2</b> Hortonworks</a></li>
<li class="chapter" data-level="5.3.3" data-path="on-premise.html"><a href="on-premise.html#mapr"><i class="fa fa-check"></i><b>5.3.3</b> MapR</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="cloud.html"><a href="cloud.html"><i class="fa fa-check"></i><b>5.4</b> Cloud</a><ul>
<li class="chapter" data-level="5.4.1" data-path="cloud.html"><a href="cloud.html#amazon"><i class="fa fa-check"></i><b>5.4.1</b> Amazon</a></li>
<li class="chapter" data-level="5.4.2" data-path="cloud.html"><a href="cloud.html#google"><i class="fa fa-check"></i><b>5.4.2</b> Google</a></li>
<li class="chapter" data-level="5.4.3" data-path="cloud.html"><a href="cloud.html#microsoft"><i class="fa fa-check"></i><b>5.4.3</b> Microsoft</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="tools.html"><a href="tools.html"><i class="fa fa-check"></i><b>5.5</b> Tools</a><ul>
<li class="chapter" data-level="5.5.1" data-path="tools.html"><a href="tools.html#rstudio"><i class="fa fa-check"></i><b>5.5.1</b> RStudio</a></li>
<li class="chapter" data-level="5.5.2" data-path="tools.html"><a href="tools.html#clusters-livy"><i class="fa fa-check"></i><b>5.5.2</b> Livy</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="recap-1.html"><a href="recap-1.html"><i class="fa fa-check"></i><b>5.6</b> Recap</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="connections.html"><a href="connections.html"><i class="fa fa-check"></i><b>6</b> Connections</a><ul>
<li class="chapter" data-level="6.1" data-path="overview-3.html"><a href="overview-3.html"><i class="fa fa-check"></i><b>6.1</b> Overview</a><ul>
<li class="chapter" data-level="6.1.1" data-path="overview-3.html"><a href="overview-3.html#edge-nodes"><i class="fa fa-check"></i><b>6.1.1</b> Edge Nodes</a></li>
<li class="chapter" data-level="6.1.2" data-path="overview-3.html"><a href="overview-3.html#spark-home"><i class="fa fa-check"></i><b>6.1.2</b> Spark Home</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="types.html"><a href="types.html"><i class="fa fa-check"></i><b>6.2</b> Types</a><ul>
<li class="chapter" data-level="6.2.1" data-path="types.html"><a href="types.html#connection-local"><i class="fa fa-check"></i><b>6.2.1</b> Local</a></li>
<li class="chapter" data-level="6.2.2" data-path="types.html"><a href="types.html#standalone"><i class="fa fa-check"></i><b>6.2.2</b> Standalone</a></li>
<li class="chapter" data-level="6.2.3" data-path="types.html"><a href="types.html#yarn-1"><i class="fa fa-check"></i><b>6.2.3</b> Yarn</a></li>
<li class="chapter" data-level="6.2.4" data-path="types.html"><a href="types.html#livy"><i class="fa fa-check"></i><b>6.2.4</b> Livy</a></li>
<li class="chapter" data-level="6.2.5" data-path="types.html"><a href="types.html#mesos-1"><i class="fa fa-check"></i><b>6.2.5</b> Mesos</a></li>
<li class="chapter" data-level="6.2.6" data-path="types.html"><a href="types.html#kubernetes-1"><i class="fa fa-check"></i><b>6.2.6</b> Kubernetes</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="troubleshooting.html"><a href="troubleshooting.html"><i class="fa fa-check"></i><b>6.3</b> Troubleshooting</a><ul>
<li class="chapter" data-level="6.3.1" data-path="troubleshooting.html"><a href="troubleshooting.html#logging"><i class="fa fa-check"></i><b>6.3.1</b> Logging</a></li>
<li class="chapter" data-level="6.3.2" data-path="troubleshooting.html"><a href="troubleshooting.html#troubleshoot-spark-submit"><i class="fa fa-check"></i><b>6.3.2</b> Spark Submit</a></li>
<li class="chapter" data-level="6.3.3" data-path="troubleshooting.html"><a href="troubleshooting.html#multiple"><i class="fa fa-check"></i><b>6.3.3</b> Multiple</a></li>
<li class="chapter" data-level="6.3.4" data-path="troubleshooting.html"><a href="troubleshooting.html#windows"><i class="fa fa-check"></i><b>6.3.4</b> Windows</a></li>
<li class="chapter" data-level="6.3.5" data-path="troubleshooting.html"><a href="troubleshooting.html#submit-manually"><i class="fa fa-check"></i><b>6.3.5</b> Submit Manually</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="recap-2.html"><a href="recap-2.html"><i class="fa fa-check"></i><b>6.4</b> Recap</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="data.html"><a href="data.html"><i class="fa fa-check"></i><b>7</b> Data</a><ul>
<li class="chapter" data-level="7.1" data-path="overview-4.html"><a href="overview-4.html"><i class="fa fa-check"></i><b>7.1</b> Overview</a></li>
<li class="chapter" data-level="7.2" data-path="dataframes.html"><a href="dataframes.html"><i class="fa fa-check"></i><b>7.2</b> DataFrames</a><ul>
<li class="chapter" data-level="7.2.1" data-path="dataframes.html"><a href="dataframes.html#data-sdf-functions"><i class="fa fa-check"></i><b>7.2.1</b> Functions</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="formats.html"><a href="formats.html"><i class="fa fa-check"></i><b>7.3</b> Formats</a></li>
<li class="chapter" data-level="7.4" data-path="data-types.html"><a href="data-types.html"><i class="fa fa-check"></i><b>7.4</b> Data Types</a><ul>
<li class="chapter" data-level="7.4.1" data-path="data-types.html"><a href="data-types.html#dates"><i class="fa fa-check"></i><b>7.4.1</b> Dates</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="external.html"><a href="external.html"><i class="fa fa-check"></i><b>7.5</b> External</a><ul>
<li class="chapter" data-level="7.5.1" data-path="external.html"><a href="external.html#amazon-s3"><i class="fa fa-check"></i><b>7.5.1</b> Amazon S3</a></li>
<li class="chapter" data-level="7.5.2" data-path="external.html"><a href="external.html#cassandra"><i class="fa fa-check"></i><b>7.5.2</b> Cassandra</a></li>
<li class="chapter" data-level="7.5.3" data-path="external.html"><a href="external.html#databases"><i class="fa fa-check"></i><b>7.5.3</b> Databases</a></li>
<li class="chapter" data-level="7.5.4" data-path="external.html"><a href="external.html#switching"><i class="fa fa-check"></i><b>7.5.4</b> Switching</a></li>
<li class="chapter" data-level="7.5.5" data-path="external.html"><a href="external.html#hbase"><i class="fa fa-check"></i><b>7.5.5</b> HBase</a></li>
<li class="chapter" data-level="7.5.6" data-path="external.html"><a href="external.html#nested-data"><i class="fa fa-check"></i><b>7.5.6</b> Nested Data</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="troubleshooting-1.html"><a href="troubleshooting-1.html"><i class="fa fa-check"></i><b>7.6</b> Troubleshooting</a><ul>
<li class="chapter" data-level="7.6.1" data-path="troubleshooting-1.html"><a href="troubleshooting-1.html#troubleshoot-csvs"><i class="fa fa-check"></i><b>7.6.1</b> Troubleshoot CSVs</a></li>
<li class="chapter" data-level="7.6.2" data-path="troubleshooting-1.html"><a href="troubleshooting-1.html#column-names"><i class="fa fa-check"></i><b>7.6.2</b> Column Names</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="recap-3.html"><a href="recap-3.html"><i class="fa fa-check"></i><b>7.7</b> Recap</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="tuning.html"><a href="tuning.html"><i class="fa fa-check"></i><b>8</b> Tuning</a><ul>
<li class="chapter" data-level="8.1" data-path="overview-5.html"><a href="overview-5.html"><i class="fa fa-check"></i><b>8.1</b> Overview</a><ul>
<li class="chapter" data-level="8.1.1" data-path="overview-5.html"><a href="overview-5.html#tunning-graph-vusualization"><i class="fa fa-check"></i><b>8.1.1</b> Graph Visualization</a></li>
<li class="chapter" data-level="8.1.2" data-path="overview-5.html"><a href="overview-5.html#tunning-event-timeline"><i class="fa fa-check"></i><b>8.1.2</b> Event Timeline</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="tunning-configuring.html"><a href="tunning-configuring.html"><i class="fa fa-check"></i><b>8.2</b> Configuring</a><ul>
<li class="chapter" data-level="8.2.1" data-path="tunning-configuring.html"><a href="tunning-configuring.html#submit-settings"><i class="fa fa-check"></i><b>8.2.1</b> Submit Settings</a></li>
<li class="chapter" data-level="8.2.2" data-path="tunning-configuring.html"><a href="tunning-configuring.html#runtime-settings"><i class="fa fa-check"></i><b>8.2.2</b> Runtime Settings</a></li>
<li class="chapter" data-level="8.2.3" data-path="tunning-configuring.html"><a href="tunning-configuring.html#sparklyr-settings"><i class="fa fa-check"></i><b>8.2.3</b> Sparklyr Settings</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="tunning-partitioning.html"><a href="tunning-partitioning.html"><i class="fa fa-check"></i><b>8.3</b> Partitioning</a><ul>
<li class="chapter" data-level="8.3.1" data-path="tunning-partitioning.html"><a href="tunning-partitioning.html#implicit"><i class="fa fa-check"></i><b>8.3.1</b> Implicit</a></li>
<li class="chapter" data-level="8.3.2" data-path="tunning-partitioning.html"><a href="tunning-partitioning.html#explicit"><i class="fa fa-check"></i><b>8.3.2</b> Explicit</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="tunning-caching.html"><a href="tunning-caching.html"><i class="fa fa-check"></i><b>8.4</b> Caching</a><ul>
<li class="chapter" data-level="8.4.1" data-path="tunning-caching.html"><a href="tunning-caching.html#checkpointing"><i class="fa fa-check"></i><b>8.4.1</b> Checkpointing</a></li>
<li class="chapter" data-level="8.4.2" data-path="tunning-caching.html"><a href="tunning-caching.html#tunning-memory"><i class="fa fa-check"></i><b>8.4.2</b> Memory</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="tunning-shuffling.html"><a href="tunning-shuffling.html"><i class="fa fa-check"></i><b>8.5</b> Shuffling</a></li>
<li class="chapter" data-level="8.6" data-path="tunning-serialization.html"><a href="tunning-serialization.html"><i class="fa fa-check"></i><b>8.6</b> Serialization</a></li>
<li class="chapter" data-level="8.7" data-path="recap-4.html"><a href="recap-4.html"><i class="fa fa-check"></i><b>8.7</b> Recap</a></li>
</ul></li>
<li class="part"><span><b>IV Extensions</b></span></li>
<li class="chapter" data-level="9" data-path="extensions.html"><a href="extensions.html"><i class="fa fa-check"></i><b>9</b> Extensions</a><ul>
<li class="chapter" data-level="9.1" data-path="rsparkling.html"><a href="rsparkling.html"><i class="fa fa-check"></i><b>9.1</b> RSparkling</a></li>
<li class="chapter" data-level="9.2" data-path="graphframes.html"><a href="graphframes.html"><i class="fa fa-check"></i><b>9.2</b> GraphFrames</a></li>
<li class="chapter" data-level="9.3" data-path="mleap.html"><a href="mleap.html"><i class="fa fa-check"></i><b>9.3</b> Mleap</a></li>
<li class="chapter" data-level="9.4" data-path="extensions-nested-data.html"><a href="extensions-nested-data.html"><i class="fa fa-check"></i><b>9.4</b> Nested Data</a></li>
</ul></li>
<li class="part"><span><b>V Advanced</b></span></li>
<li class="chapter" data-level="10" data-path="distributed.html"><a href="distributed.html"><i class="fa fa-check"></i><b>10</b> Distributed R</a><ul>
<li class="chapter" data-level="10.1" data-path="use-cases.html"><a href="use-cases.html"><i class="fa fa-check"></i><b>10.1</b> Use Cases</a><ul>
<li class="chapter" data-level="10.1.1" data-path="use-cases.html"><a href="use-cases.html#embarrassingly-parallel"><i class="fa fa-check"></i><b>10.1.1</b> Embarrassingly Parallel</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="columns.html"><a href="columns.html"><i class="fa fa-check"></i><b>10.2</b> Columns</a><ul>
<li class="chapter" data-level="10.2.1" data-path="columns.html"><a href="columns.html#inference"><i class="fa fa-check"></i><b>10.2.1</b> Inference</a></li>
<li class="chapter" data-level="10.2.2" data-path="columns.html"><a href="columns.html#excplicit"><i class="fa fa-check"></i><b>10.2.2</b> Excplicit</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="grouping.html"><a href="grouping.html"><i class="fa fa-check"></i><b>10.3</b> Grouping</a></li>
<li class="chapter" data-level="10.4" data-path="packages.html"><a href="packages.html"><i class="fa fa-check"></i><b>10.4</b> Packages</a></li>
<li class="chapter" data-level="10.5" data-path="restrictions.html"><a href="restrictions.html"><i class="fa fa-check"></i><b>10.5</b> Restrictions</a></li>
<li class="chapter" data-level="10.6" data-path="troubleshooting-2.html"><a href="troubleshooting-2.html"><i class="fa fa-check"></i><b>10.6</b> Troubleshooting</a><ul>
<li class="chapter" data-level="10.6.1" data-path="troubleshooting-2.html"><a href="troubleshooting-2.html#tips"><i class="fa fa-check"></i><b>10.6.1</b> Tips</a></li>
<li class="chapter" data-level="10.6.2" data-path="troubleshooting-2.html"><a href="troubleshooting-2.html#logs-1"><i class="fa fa-check"></i><b>10.6.2</b> Logs</a></li>
<li class="chapter" data-level="10.6.3" data-path="troubleshooting-2.html"><a href="troubleshooting-2.html#debugging"><i class="fa fa-check"></i><b>10.6.3</b> Debugging</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="streaming.html"><a href="streaming.html"><i class="fa fa-check"></i><b>11</b> Streaming</a><ul>
<li class="chapter" data-level="11.1" data-path="overview-6.html"><a href="overview-6.html"><i class="fa fa-check"></i><b>11.1</b> Overview</a></li>
<li class="chapter" data-level="11.2" data-path="transformations.html"><a href="transformations.html"><i class="fa fa-check"></i><b>11.2</b> Transformations</a><ul>
<li class="chapter" data-level="11.2.1" data-path="transformations.html"><a href="transformations.html#streams-dplyr"><i class="fa fa-check"></i><b>11.2.1</b> dplyr</a></li>
<li class="chapter" data-level="11.2.2" data-path="transformations.html"><a href="transformations.html#streams-pipelines"><i class="fa fa-check"></i><b>11.2.2</b> Pipelines</a></li>
<li class="chapter" data-level="11.2.3" data-path="transformations.html"><a href="transformations.html#streams-r"><i class="fa fa-check"></i><b>11.2.3</b> R Code</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="shiny.html"><a href="shiny.html"><i class="fa fa-check"></i><b>11.3</b> Shiny</a></li>
<li class="chapter" data-level="11.4" data-path="formats-1.html"><a href="formats-1.html"><i class="fa fa-check"></i><b>11.4</b> Formats</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="contributing.html"><a href="contributing.html"><i class="fa fa-check"></i><b>12</b> Contributing</a><ul>
<li class="chapter" data-level="12.1" data-path="overview-7.html"><a href="overview-7.html"><i class="fa fa-check"></i><b>12.1</b> Overview</a></li>
<li class="chapter" data-level="12.2" data-path="contributing-extensions.html"><a href="contributing-extensions.html"><i class="fa fa-check"></i><b>12.2</b> Extensions</a><ul>
<li class="chapter" data-level="12.2.1" data-path="contributing-extensions.html"><a href="contributing-extensions.html#rstudio-projects"><i class="fa fa-check"></i><b>12.2.1</b> RStudio Projects</a></li>
<li class="chapter" data-level="12.2.2" data-path="contributing-extensions.html"><a href="contributing-extensions.html#troubleshooting-3"><i class="fa fa-check"></i><b>12.2.2</b> Troubleshooting</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="contributing-sparklyr.html"><a href="contributing-sparklyr.html"><i class="fa fa-check"></i><b>12.3</b> sparklyr</a><ul>
<li class="chapter" data-level="12.3.1" data-path="contributing-sparklyr.html"><a href="contributing-sparklyr.html#scala"><i class="fa fa-check"></i><b>12.3.1</b> Scala</a></li>
<li class="chapter" data-level="12.3.2" data-path="contributing-sparklyr.html"><a href="contributing-sparklyr.html#serialization"><i class="fa fa-check"></i><b>12.3.2</b> Serialization</a></li>
<li class="chapter" data-level="12.3.3" data-path="contributing-sparklyr.html"><a href="contributing-sparklyr.html#invocations"><i class="fa fa-check"></i><b>12.3.3</b> Invocations</a></li>
<li class="chapter" data-level="12.3.4" data-path="contributing-sparklyr.html"><a href="contributing-sparklyr.html#r-packages"><i class="fa fa-check"></i><b>12.3.4</b> R Packages</a></li>
<li class="chapter" data-level="12.3.5" data-path="contributing-sparklyr.html"><a href="contributing-sparklyr.html#connections-1"><i class="fa fa-check"></i><b>12.3.5</b> Connections</a></li>
<li class="chapter" data-level="12.3.6" data-path="contributing-sparklyr.html"><a href="contributing-sparklyr.html#distributed-r"><i class="fa fa-check"></i><b>12.3.6</b> Distributed R</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>VI Appendix</b></span></li>
<li class="chapter" data-level="13" data-path="appendix.html"><a href="appendix.html"><i class="fa fa-check"></i><b>13</b> Appendix</a><ul>
<li class="chapter" data-level="13.1" data-path="diagrams.html"><a href="diagrams.html"><i class="fa fa-check"></i><b>13.1</b> Diagrams</a><ul>
<li class="chapter" data-level="13.1.1" data-path="diagrams.html"><a href="diagrams.html#storage-capacity"><i class="fa fa-check"></i><b>13.1.1</b> Worlds Store Capacity</a></li>
<li class="chapter" data-level="13.1.2" data-path="diagrams.html"><a href="diagrams.html#cran-downloads"><i class="fa fa-check"></i><b>13.1.2</b> Daily downloads of CRAN packages</a></li>
<li class="chapter" data-level="13.1.3" data-path="diagrams.html"><a href="diagrams.html#cluster-trends"><i class="fa fa-check"></i><b>13.1.3</b> Google trends for mainframes, cloud computing and kubernetes</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>14</b> References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">The R in Spark: Learning Apache Spark with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="types" class="section level2">
<h2><span class="header-section-number">6.2</span> Types</h2>
<div id="connection-local" class="section level3">
<h3><span class="header-section-number">6.2.1</span> Local</h3>
<p>When connecting to Spark in local mode, Spark starts as a single application simulating a cluster with a single node, this is not a proper computing cluster but is ideal to perform work offline and troubleshoot issues. A local connection to Spark is represented in the following diagram:</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-45"></span>
<div id="htmlwidget-93d16336cc068dd5b0bd" style="width:100%;height:160pt;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-93d16336cc068dd5b0bd">{"x":{"data":null,"type":"NULL","container":"svg","options":null,"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n/* R2D3 Source File:  images/06-connections-diagram.js */\n\nsvg.append(\"svg:defs\").append(\"svg:marker\")\n  .attr(\"id\", \"circle\")\n  .attr(\"refX\", 6)\n  .attr(\"refY\", 6)\n  .attr(\"markerWidth\", 12)\n  .attr(\"markerHeight\", 12)\n  .attr(\"orient\", \"auto\")\n  .append(\"circle\")\n  .attr(\"cx\", \"6\")\n  .attr(\"cy\", \"6\")\n  .attr(\"r\", \"3\")\n  .attr(\"class\", \"block-link\")\n  .attr(\"stroke-width\", 1);\n\nfunction diagramRoot(maxWidth) {\n  if (!maxWidth) maxWidth = 500;\n\n  var scaleX = 1;\n  var scaleY = 1;\n  height = height - 20;\n\n  var newWidth = width > maxWidth ? maxWidth : width;\n  var translateX = width > newWidth ? (width - newWidth) / 2 : 0;\n  var translateY = 10;\n  width = newWidth;\n\n  svg\n    .attr(\"font-size\", Math.min(width, 500) / 600 + \"em\")\n    .attr(\"font-family\", \"sans-serif\");\n\n  var root = svg.append(\"g\")\n    .attr(\"transform\", \"translate(\" + translateX + \",\" + translateY + \")scale(\" + scaleX + \",\" + scaleY + \")\");\n\n  return root;\n}\n\nfunction drawBlock(parent, block) {\n  if (!block.x) block.x = 0;\n  if (!block.y) block.y = 0;\n  if (!block.width) block.width = blockWidth;\n  if (!block.height) block.height = blockHeight;\n  if (!block.color) block.color = \"#bbcce0\";\n  if (!block.label) block.label = \"<label>\";\n  if (!block.style) block.style = \"block\";\n\n  var startX = block.x - block.width / 2;\n  var startY = block.y - block.height / 2;\n\n  parent.append(\"rect\")\n    .attr(\"x\", startX)\n    .attr(\"y\", startY)\n    .attr(\"width\", block.width)\n    .attr(\"height\", block.height)\n    .attr(\"class\", block.style);\n\n  var current = parent.append(\"text\")\n    .attr(\"x\", block.x)\n    .attr(\"y\", startY + 20)\n    .attr(\"fill\", \"white\")\n    .attr(\"text-anchor\", \"middle\")\n    .text(block.label);\n\n  if (block.childrens) {\n    for (var childIdx in block.childrens) {\n      var child = block.childrens[childIdx];\n\n      if (!child.width) child.width = block.width - 20;\n      if (!child.x) child.x = block.x;\n      if (child.position === undefined) child.position = childIdx;\n      if (child.style === undefined) child.style = \"block-children\";\n\n      var childBlock = {\n        x: child.x,\n        y: startY + 46 + child.position * 34,\n        width: child.width,\n        height: 30,\n        label: child.label,\n        style: child.style\n      };\n\n      drawBlock(parent, childBlock);\n    }\n  }\n\n  return block;\n}\n\nfunction linkBlocks(block1, block2, label) {\n  var block1right = block1.x + block1.width / 2;\n  var block2left = block2.x - block2.width / 2;\n  var block1bottom = block1.y + block1.height / 2;\n  var block2top = block2.y - block2.height / 2;\n\n  var horizontal = block1right < block2left;\n\n  root.append('line')\n    .attr(\"x1\", horizontal ? block1right : block1.x)\n    .attr(\"y1\", horizontal ? block1.y : block1bottom)\n    .attr(\"x2\", horizontal ? block2left : block2.x)\n    .attr(\"y2\", horizontal ? block2.y : block2top)\n  \t.attr(\"class\", \"block-link\")\n  \t.attr(\"stroke-width\", \"1\")\n  \t.attr(\"marker-start\", \"url(#circle)\")\n  \t.attr(\"marker-end\", \"url(#circle)\")\n  \t.attr(\"stroke-dasharray\", \"3,7\");\n\n  var labelFits = horizontal ?\n    Math.abs(block2left - block1right) > block1.width / 2 :\n    Math.abs(block2top - block1bottom) > 30;\n\n  if (label && labelFits) {\n    root.append('text')\n      .attr(\"dy\", (horizontal ? \"-\" : \"\") + \"0.4em\")\n      .attr(\"x\", block1right + (block2left - block1right) / 2)\n      .attr(\"y\", block1bottom + (block2top - block1bottom) / 2)\n      .attr(\"text-anchor\", \"middle\")\n      .attr(\"fill\", \"#759cc7\")\n      .text(label);\n  }\n}\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  images/06-connections-local.js */\n// !preview r2d3 dependencies=\"images/06-connections-diagram.js\", css=\"images/06-connections-diagram.css\"\n//\n// r2d3: https://rstudio.github.io/r2d3\n//\n\nvar root = diagramRoot();\nvar blockWidth = width / 3.5;\nvar blockHeight = Math.min(140, height * 0.8);\n\nvar driverBlock = drawBlock(root, {\n  x: width / 2,\n  y: height / 2,\n  height: height,\n  label: \"Driver\",\n  childrens: [{\n    label: \"R\"\n  }, {\n    label: \"sparklyr\"\n  }, {\n    label: \"Spark Context\"\n  }, {\n    label: \"Spark Executor\"\n  }]\n});\n\n};","style":"/* R2D3 Source File:  images/06-connections-diagram.css */\n.block {\n  fill: #bbcce0;\n}\n\n.block-children {\n  fill:  #93acc7;\n}\n\n.block-link {\n  fill: white;\n  stroke: #bbcce0;\n}","version":5,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
<p class="caption">
FIGURE 6.3: Local Connection Diagram
</p>
</div>
<p>Notice that in the local connections diagram, there is no cluster manager nor worker process since, in local mode, everything runs inside the driver application. It’s also worth pointing out that <code>sparklyr</code> starts the Spark Context through <code>spark-submit</code>, a script available in every Spark installation to enable users to submit custom application to Spark which <code>sparklyr</code> makes use of to submit itself to Spark. For the curious reader, the <a href="contributing.html#contributing">Contributing</a> chapter explains the internal processes that take place in <code>sparklyr</code> to submit this application and connect properly from R.</p>
<p>To perform this local connection, we can connect with the following familiar code used in previous chapters:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" data-line-number="1"><span class="co"># Connect to local Spark instance</span></a>
<a class="sourceLine" id="cb39-2" data-line-number="2">sc &lt;-<span class="st"> </span><span class="kw">spark_connect</span>(<span class="dt">master =</span> <span class="st">&quot;local&quot;</span>)</a></code></pre></div>
<p>By default, <code>sparklyr</code>, will connect using as many CPU cores are available in your compute instance; however, this can be customized by connecting using <code>master=&quot;local[n]&quot;</code>, where <code>n</code> is the desired number of cores to use. For example, we can connect using only 2 CPU cores as follows:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" data-line-number="1"><span class="co"># Connect to local Spark instance using 2 cores</span></a>
<a class="sourceLine" id="cb40-2" data-line-number="2">sc &lt;-<span class="st"> </span><span class="kw">spark_connect</span>(<span class="dt">master =</span> <span class="st">&quot;local[2]&quot;</span>)</a></code></pre></div>
</div>
<div id="standalone" class="section level3">
<h3><span class="header-section-number">6.2.2</span> Standalone</h3>
<p>Connecting to a Spark Standalone cluster requires the location of the cluster manager’s master instance, this location can be found in the cluster manager web interface as described in the <a href="standalone%20cluster">clusters-standalone</a> section, you can find this location by looking for a URL starting with <code>spark://</code>.</p>
<p>A connection in standalone mode starts from <code>sparklyr</code> launching <code>spark-submit</code> to submit the <code>sparklyr</code> application and creating the Spark Context, which requests executors to Spark’s standalone cluster manager in the <code>master</code> location:</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-48"></span>
<div id="htmlwidget-4ac93952b5734a0f3109" style="width:100%;height:480px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-4ac93952b5734a0f3109">{"x":{"data":null,"type":"NULL","container":"svg","options":null,"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n/* R2D3 Source File:  images/06-connections-diagram.js */\n\nsvg.append(\"svg:defs\").append(\"svg:marker\")\n  .attr(\"id\", \"circle\")\n  .attr(\"refX\", 6)\n  .attr(\"refY\", 6)\n  .attr(\"markerWidth\", 12)\n  .attr(\"markerHeight\", 12)\n  .attr(\"orient\", \"auto\")\n  .append(\"circle\")\n  .attr(\"cx\", \"6\")\n  .attr(\"cy\", \"6\")\n  .attr(\"r\", \"3\")\n  .attr(\"class\", \"block-link\")\n  .attr(\"stroke-width\", 1);\n\nfunction diagramRoot(maxWidth) {\n  if (!maxWidth) maxWidth = 500;\n\n  var scaleX = 1;\n  var scaleY = 1;\n  height = height - 20;\n\n  var newWidth = width > maxWidth ? maxWidth : width;\n  var translateX = width > newWidth ? (width - newWidth) / 2 : 0;\n  var translateY = 10;\n  width = newWidth;\n\n  svg\n    .attr(\"font-size\", Math.min(width, 500) / 600 + \"em\")\n    .attr(\"font-family\", \"sans-serif\");\n\n  var root = svg.append(\"g\")\n    .attr(\"transform\", \"translate(\" + translateX + \",\" + translateY + \")scale(\" + scaleX + \",\" + scaleY + \")\");\n\n  return root;\n}\n\nfunction drawBlock(parent, block) {\n  if (!block.x) block.x = 0;\n  if (!block.y) block.y = 0;\n  if (!block.width) block.width = blockWidth;\n  if (!block.height) block.height = blockHeight;\n  if (!block.color) block.color = \"#bbcce0\";\n  if (!block.label) block.label = \"<label>\";\n  if (!block.style) block.style = \"block\";\n\n  var startX = block.x - block.width / 2;\n  var startY = block.y - block.height / 2;\n\n  parent.append(\"rect\")\n    .attr(\"x\", startX)\n    .attr(\"y\", startY)\n    .attr(\"width\", block.width)\n    .attr(\"height\", block.height)\n    .attr(\"class\", block.style);\n\n  var current = parent.append(\"text\")\n    .attr(\"x\", block.x)\n    .attr(\"y\", startY + 20)\n    .attr(\"fill\", \"white\")\n    .attr(\"text-anchor\", \"middle\")\n    .text(block.label);\n\n  if (block.childrens) {\n    for (var childIdx in block.childrens) {\n      var child = block.childrens[childIdx];\n\n      if (!child.width) child.width = block.width - 20;\n      if (!child.x) child.x = block.x;\n      if (child.position === undefined) child.position = childIdx;\n      if (child.style === undefined) child.style = \"block-children\";\n\n      var childBlock = {\n        x: child.x,\n        y: startY + 46 + child.position * 34,\n        width: child.width,\n        height: 30,\n        label: child.label,\n        style: child.style\n      };\n\n      drawBlock(parent, childBlock);\n    }\n  }\n\n  return block;\n}\n\nfunction linkBlocks(block1, block2, label) {\n  var block1right = block1.x + block1.width / 2;\n  var block2left = block2.x - block2.width / 2;\n  var block1bottom = block1.y + block1.height / 2;\n  var block2top = block2.y - block2.height / 2;\n\n  var horizontal = block1right < block2left;\n\n  root.append('line')\n    .attr(\"x1\", horizontal ? block1right : block1.x)\n    .attr(\"y1\", horizontal ? block1.y : block1bottom)\n    .attr(\"x2\", horizontal ? block2left : block2.x)\n    .attr(\"y2\", horizontal ? block2.y : block2top)\n  \t.attr(\"class\", \"block-link\")\n  \t.attr(\"stroke-width\", \"1\")\n  \t.attr(\"marker-start\", \"url(#circle)\")\n  \t.attr(\"marker-end\", \"url(#circle)\")\n  \t.attr(\"stroke-dasharray\", \"3,7\");\n\n  var labelFits = horizontal ?\n    Math.abs(block2left - block1right) > block1.width / 2 :\n    Math.abs(block2top - block1bottom) > 30;\n\n  if (label && labelFits) {\n    root.append('text')\n      .attr(\"dy\", (horizontal ? \"-\" : \"\") + \"0.4em\")\n      .attr(\"x\", block1right + (block2left - block1right) / 2)\n      .attr(\"y\", block1bottom + (block2top - block1bottom) / 2)\n      .attr(\"text-anchor\", \"middle\")\n      .attr(\"fill\", \"#759cc7\")\n      .text(label);\n  }\n}\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  images/06-connections-standalone.js */\n// !preview r2d3 dependencies=\"images/06-connections-diagram.js\", css=\"images/06-connections-diagram.css\"\n//\n// r2d3: https://rstudio.github.io/r2d3\n//\n\nvar root = diagramRoot(600);\nvar blockWidth = width / 4.0;\n\nvar totalWorkers = 3;\nvar blockHeight = height / totalWorkers - 10;\n\nvar driverBlock = drawBlock(root, {\n  x: blockWidth / 2,\n  y: height / 2,\n  height: 150,\n  label: \"Driver\",\n  childrens: [{\n    label: \"R\"\n  }, {\n    label: \"sparklyr\"\n  }, {\n    label: \"Spark Context\"\n  }]\n});\n\nvar clusterBlock = drawBlock(root, {\n  x: width / 2,\n  y: height / 2,\n  height: 80,\n  label: \"Cluster Manager\",\n  childrens: [{\n    label: \"Spark Standalone\"\n  }]\n});\n\nvar workers = new Array(totalWorkers);\nfor (var i = 0; i < totalWorkers; i++) {\n  workers[i] = drawBlock(root, {\n    x: width - blockWidth / 2,\n    y: 5 + blockHeight / 2 + height / totalWorkers * i,\n    height: blockHeight,\n    label: \"Worker\",\n    childrens: [{\n      label: \"Spark Executor\",\n      color: \"#759cc7\"\n    }, {\n      label: \"Spark Executor\",\n      color: \"#759cc7\"\n    }]\n  });\n}\n\nlinkBlocks(driverBlock, clusterBlock);\nfor (var i = 0; i < workers.length; i++) {\n  linkBlocks(clusterBlock, workers[i]);\n}\n};","style":"/* R2D3 Source File:  images/06-connections-diagram.css */\n.block {\n  fill: #bbcce0;\n}\n\n.block-children {\n  fill:  #93acc7;\n}\n\n.block-link {\n  fill: white;\n  stroke: #bbcce0;\n}","version":5,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
<p class="caption">
FIGURE 6.4: Spark Standalone Connection Diagram
</p>
</div>
<p>In order to connect, use <code>master=&quot;spark://hostname:port&quot;</code> in <code>spark_connect()</code> as follows:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" data-line-number="1">sc &lt;-<span class="st"> </span><span class="kw">spark_connect</span>(<span class="dt">master =</span> <span class="st">&quot;spark://hostname:port&quot;</span>)</a></code></pre></div>
</div>
<div id="yarn-1" class="section level3">
<h3><span class="header-section-number">6.2.3</span> Yarn</h3>
<p>Hadoop YARN supports two connection modes: YARN Client and YARN Cluster. However, YARN Client mode is much more common that YARN Cluster since it’s more efficient and easier to set up.</p>
<div id="yarn-client" class="section level4">
<h4><span class="header-section-number">6.2.3.1</span> Yarn Client</h4>
<p>When connecting in YARN Client mode, the driver instance runs R, sparklyr and the Spark Context which requests worker nodes from YARN to run Spark executors as follows:</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-50"></span>
<div id="htmlwidget-a7144ed2a8023817bf06" style="width:100%;height:480px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-a7144ed2a8023817bf06">{"x":{"data":null,"type":"NULL","container":"svg","options":null,"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n/* R2D3 Source File:  images/06-connections-diagram.js */\n\nsvg.append(\"svg:defs\").append(\"svg:marker\")\n  .attr(\"id\", \"circle\")\n  .attr(\"refX\", 6)\n  .attr(\"refY\", 6)\n  .attr(\"markerWidth\", 12)\n  .attr(\"markerHeight\", 12)\n  .attr(\"orient\", \"auto\")\n  .append(\"circle\")\n  .attr(\"cx\", \"6\")\n  .attr(\"cy\", \"6\")\n  .attr(\"r\", \"3\")\n  .attr(\"class\", \"block-link\")\n  .attr(\"stroke-width\", 1);\n\nfunction diagramRoot(maxWidth) {\n  if (!maxWidth) maxWidth = 500;\n\n  var scaleX = 1;\n  var scaleY = 1;\n  height = height - 20;\n\n  var newWidth = width > maxWidth ? maxWidth : width;\n  var translateX = width > newWidth ? (width - newWidth) / 2 : 0;\n  var translateY = 10;\n  width = newWidth;\n\n  svg\n    .attr(\"font-size\", Math.min(width, 500) / 600 + \"em\")\n    .attr(\"font-family\", \"sans-serif\");\n\n  var root = svg.append(\"g\")\n    .attr(\"transform\", \"translate(\" + translateX + \",\" + translateY + \")scale(\" + scaleX + \",\" + scaleY + \")\");\n\n  return root;\n}\n\nfunction drawBlock(parent, block) {\n  if (!block.x) block.x = 0;\n  if (!block.y) block.y = 0;\n  if (!block.width) block.width = blockWidth;\n  if (!block.height) block.height = blockHeight;\n  if (!block.color) block.color = \"#bbcce0\";\n  if (!block.label) block.label = \"<label>\";\n  if (!block.style) block.style = \"block\";\n\n  var startX = block.x - block.width / 2;\n  var startY = block.y - block.height / 2;\n\n  parent.append(\"rect\")\n    .attr(\"x\", startX)\n    .attr(\"y\", startY)\n    .attr(\"width\", block.width)\n    .attr(\"height\", block.height)\n    .attr(\"class\", block.style);\n\n  var current = parent.append(\"text\")\n    .attr(\"x\", block.x)\n    .attr(\"y\", startY + 20)\n    .attr(\"fill\", \"white\")\n    .attr(\"text-anchor\", \"middle\")\n    .text(block.label);\n\n  if (block.childrens) {\n    for (var childIdx in block.childrens) {\n      var child = block.childrens[childIdx];\n\n      if (!child.width) child.width = block.width - 20;\n      if (!child.x) child.x = block.x;\n      if (child.position === undefined) child.position = childIdx;\n      if (child.style === undefined) child.style = \"block-children\";\n\n      var childBlock = {\n        x: child.x,\n        y: startY + 46 + child.position * 34,\n        width: child.width,\n        height: 30,\n        label: child.label,\n        style: child.style\n      };\n\n      drawBlock(parent, childBlock);\n    }\n  }\n\n  return block;\n}\n\nfunction linkBlocks(block1, block2, label) {\n  var block1right = block1.x + block1.width / 2;\n  var block2left = block2.x - block2.width / 2;\n  var block1bottom = block1.y + block1.height / 2;\n  var block2top = block2.y - block2.height / 2;\n\n  var horizontal = block1right < block2left;\n\n  root.append('line')\n    .attr(\"x1\", horizontal ? block1right : block1.x)\n    .attr(\"y1\", horizontal ? block1.y : block1bottom)\n    .attr(\"x2\", horizontal ? block2left : block2.x)\n    .attr(\"y2\", horizontal ? block2.y : block2top)\n  \t.attr(\"class\", \"block-link\")\n  \t.attr(\"stroke-width\", \"1\")\n  \t.attr(\"marker-start\", \"url(#circle)\")\n  \t.attr(\"marker-end\", \"url(#circle)\")\n  \t.attr(\"stroke-dasharray\", \"3,7\");\n\n  var labelFits = horizontal ?\n    Math.abs(block2left - block1right) > block1.width / 2 :\n    Math.abs(block2top - block1bottom) > 30;\n\n  if (label && labelFits) {\n    root.append('text')\n      .attr(\"dy\", (horizontal ? \"-\" : \"\") + \"0.4em\")\n      .attr(\"x\", block1right + (block2left - block1right) / 2)\n      .attr(\"y\", block1bottom + (block2top - block1bottom) / 2)\n      .attr(\"text-anchor\", \"middle\")\n      .attr(\"fill\", \"#759cc7\")\n      .text(label);\n  }\n}\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  images/06-connections-yarn-client.js */\n// !preview r2d3 dependencies=\"images/06-connections-diagram.js\", css=\"images/06-connections-diagram.css\"\n//\n// r2d3: https://rstudio.github.io/r2d3\n//\n\nvar root = diagramRoot(600);\nvar blockWidth = width / 4.0;\n\nvar totalWorkers = 3;\nvar blockHeight = height / totalWorkers - 10;\n\nvar driverBlock = drawBlock(root, {\n  x: blockWidth / 2,\n  y: height / 2,\n  height: 150,\n  label: \"Driver\",\n  childrens: [{\n    label: \"R\"\n  }, {\n    label: \"sparklyr\"\n  }, {\n    label: \"Spark Context\"\n  }]\n});\n\nvar clusterBlock = drawBlock(root, {\n  x: width / 2,\n  y: height / 2,\n  height: 80,\n  label: \"Cluster Manager\",\n  childrens: [{\n    label: \"YARN\"\n  }]\n});\n\nvar workers = new Array(totalWorkers);\nfor (var i = 0; i < totalWorkers; i++) {\n  workers[i] = drawBlock(root, {\n    x: width - blockWidth / 2,\n    y: 5 + blockHeight / 2 + height / totalWorkers * i,\n    height: blockHeight,\n    label: \"Worker\",\n    childrens: [{\n      label: \"Spark Executor\",\n      color: \"#759cc7\"\n    }, {\n      label: \"Spark Executor\",\n      color: \"#759cc7\"\n    }]\n  });\n}\n\nlinkBlocks(driverBlock, clusterBlock);\nfor (var i = 0; i < workers.length; i++) {\n  linkBlocks(clusterBlock, workers[i]);\n}\n};","style":"/* R2D3 Source File:  images/06-connections-diagram.css */\n.block {\n  fill: #bbcce0;\n}\n\n.block-children {\n  fill:  #93acc7;\n}\n\n.block-link {\n  fill: white;\n  stroke: #bbcce0;\n}","version":5,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
<p class="caption">
FIGURE 6.5: YARN Client Connection Diagram
</p>
</div>
<p>To connect, one can simply run with <code>master = &quot;yarn&quot;</code> as follows:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" data-line-number="1">sc &lt;-<span class="st"> </span><span class="kw">spark_connect</span>(<span class="dt">master =</span> <span class="st">&quot;yarn-client&quot;</span>)</a></code></pre></div>
<p>Once connected, you can use all techniques described in previous chapters using the <code>sc</code> connection; for instances, you can do <a href="analysis">data analysis</a> or <a href="modeling.html#modeling">modeling</a>.</p>
</div>
<div id="yarn-cluster" class="section level4">
<h4><span class="header-section-number">6.2.3.2</span> Yarn Cluster</h4>
<p>The main difference between YARN Cluster mode and YARN Client mode is that in YARN Cluster mode, the driver node is not required to be the node where R and sparklyr get started; instead, the driver node remains the designated driver node which is usually a different node than the edge node where R is running. It can be helpful to consider using YARN Cluster when the edge node has too many concurrent users, is lacking computing resources or where tools (like RStudio) need to be managed independently of other clsuter resources.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-52"></span>
<div id="htmlwidget-6ccdc7d0d3211bd11e25" style="width:100%;height:480px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-6ccdc7d0d3211bd11e25">{"x":{"data":null,"type":"NULL","container":"svg","options":null,"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n/* R2D3 Source File:  images/06-connections-diagram.js */\n\nsvg.append(\"svg:defs\").append(\"svg:marker\")\n  .attr(\"id\", \"circle\")\n  .attr(\"refX\", 6)\n  .attr(\"refY\", 6)\n  .attr(\"markerWidth\", 12)\n  .attr(\"markerHeight\", 12)\n  .attr(\"orient\", \"auto\")\n  .append(\"circle\")\n  .attr(\"cx\", \"6\")\n  .attr(\"cy\", \"6\")\n  .attr(\"r\", \"3\")\n  .attr(\"class\", \"block-link\")\n  .attr(\"stroke-width\", 1);\n\nfunction diagramRoot(maxWidth) {\n  if (!maxWidth) maxWidth = 500;\n\n  var scaleX = 1;\n  var scaleY = 1;\n  height = height - 20;\n\n  var newWidth = width > maxWidth ? maxWidth : width;\n  var translateX = width > newWidth ? (width - newWidth) / 2 : 0;\n  var translateY = 10;\n  width = newWidth;\n\n  svg\n    .attr(\"font-size\", Math.min(width, 500) / 600 + \"em\")\n    .attr(\"font-family\", \"sans-serif\");\n\n  var root = svg.append(\"g\")\n    .attr(\"transform\", \"translate(\" + translateX + \",\" + translateY + \")scale(\" + scaleX + \",\" + scaleY + \")\");\n\n  return root;\n}\n\nfunction drawBlock(parent, block) {\n  if (!block.x) block.x = 0;\n  if (!block.y) block.y = 0;\n  if (!block.width) block.width = blockWidth;\n  if (!block.height) block.height = blockHeight;\n  if (!block.color) block.color = \"#bbcce0\";\n  if (!block.label) block.label = \"<label>\";\n  if (!block.style) block.style = \"block\";\n\n  var startX = block.x - block.width / 2;\n  var startY = block.y - block.height / 2;\n\n  parent.append(\"rect\")\n    .attr(\"x\", startX)\n    .attr(\"y\", startY)\n    .attr(\"width\", block.width)\n    .attr(\"height\", block.height)\n    .attr(\"class\", block.style);\n\n  var current = parent.append(\"text\")\n    .attr(\"x\", block.x)\n    .attr(\"y\", startY + 20)\n    .attr(\"fill\", \"white\")\n    .attr(\"text-anchor\", \"middle\")\n    .text(block.label);\n\n  if (block.childrens) {\n    for (var childIdx in block.childrens) {\n      var child = block.childrens[childIdx];\n\n      if (!child.width) child.width = block.width - 20;\n      if (!child.x) child.x = block.x;\n      if (child.position === undefined) child.position = childIdx;\n      if (child.style === undefined) child.style = \"block-children\";\n\n      var childBlock = {\n        x: child.x,\n        y: startY + 46 + child.position * 34,\n        width: child.width,\n        height: 30,\n        label: child.label,\n        style: child.style\n      };\n\n      drawBlock(parent, childBlock);\n    }\n  }\n\n  return block;\n}\n\nfunction linkBlocks(block1, block2, label) {\n  var block1right = block1.x + block1.width / 2;\n  var block2left = block2.x - block2.width / 2;\n  var block1bottom = block1.y + block1.height / 2;\n  var block2top = block2.y - block2.height / 2;\n\n  var horizontal = block1right < block2left;\n\n  root.append('line')\n    .attr(\"x1\", horizontal ? block1right : block1.x)\n    .attr(\"y1\", horizontal ? block1.y : block1bottom)\n    .attr(\"x2\", horizontal ? block2left : block2.x)\n    .attr(\"y2\", horizontal ? block2.y : block2top)\n  \t.attr(\"class\", \"block-link\")\n  \t.attr(\"stroke-width\", \"1\")\n  \t.attr(\"marker-start\", \"url(#circle)\")\n  \t.attr(\"marker-end\", \"url(#circle)\")\n  \t.attr(\"stroke-dasharray\", \"3,7\");\n\n  var labelFits = horizontal ?\n    Math.abs(block2left - block1right) > block1.width / 2 :\n    Math.abs(block2top - block1bottom) > 30;\n\n  if (label && labelFits) {\n    root.append('text')\n      .attr(\"dy\", (horizontal ? \"-\" : \"\") + \"0.4em\")\n      .attr(\"x\", block1right + (block2left - block1right) / 2)\n      .attr(\"y\", block1bottom + (block2top - block1bottom) / 2)\n      .attr(\"text-anchor\", \"middle\")\n      .attr(\"fill\", \"#759cc7\")\n      .text(label);\n  }\n}\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  images/06-connections-yarn-cluster.js */\n// !preview r2d3 dependencies=\"images/06-connections-diagram.js\", css=\"images/06-connections-diagram.css\"\n//\n// r2d3: https://rstudio.github.io/r2d3\n//\n\nvar root = diagramRoot(600);\nvar blockWidth = width / 4.0;\n\nvar totalWorkers = 3;\nvar blockHeight = height / totalWorkers - 10;\n\nvar sparklyrBlock = drawBlock(root, {\n  x: blockWidth / 2,\n  y: blockHeight / 3,\n  height: height / 4,\n  label: \"R\",\n  childrens: [{\n    label: \"sparklyr\"\n  }]\n});\n\nvar driverBlock = drawBlock(root, {\n  x: blockWidth / 2,\n  y: height / 2,\n  height: height / 4,\n  label: \"Driver\",\n  childrens: [{\n    label: \"Spark Context\"\n  }]\n});\n\nvar clusterBlock = drawBlock(root, {\n  x: width / 2,\n  y: height / 2,\n  height: 80,\n  label: \"Cluster Manager\",\n  childrens: [{\n    label: \"YARN\"\n  }]\n});\n\nlinkBlocks(sparklyrBlock, clusterBlock);\nlinkBlocks(driverBlock, clusterBlock);\n\nvar workers = new Array(totalWorkers);\nfor (var i = 0; i < totalWorkers; i++) {\n  workers[i] = drawBlock(root, {\n    x: width - blockWidth / 2,\n    y: 5 + blockHeight / 2 + height / totalWorkers * i,\n    height: blockHeight,\n    label: \"Worker\",\n    childrens: [{\n      label: \"Spark Executor\",\n      color: \"#759cc7\"\n    }, {\n      label: \"Spark Executor\",\n      color: \"#759cc7\"\n    }]\n  });\n}\n\nfor (var i = 0; i < workers.length; i++) {\n  linkBlocks(clusterBlock, workers[i]);\n}\n};","style":"/* R2D3 Source File:  images/06-connections-diagram.css */\n.block {\n  fill: #bbcce0;\n}\n\n.block-children {\n  fill:  #93acc7;\n}\n\n.block-link {\n  fill: white;\n  stroke: #bbcce0;\n}","version":5,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
<p class="caption">
FIGURE 6.6: YARN Cluster Connection Diagram
</p>
</div>
<p>To connect in YARN Cluster mode, we can simple run:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" data-line-number="1">sc &lt;-<span class="st"> </span><span class="kw">spark_connect</span>(<span class="dt">master =</span> <span class="st">&quot;yarn-cluster&quot;</span>)</a></code></pre></div>
<p>This connection assumes that the node running <code>spark_connect()</code> is properly configured, meaning that, <code>yarn-site.xml</code> exists and the <code>YARN_CONF_DIR</code> environment variable is properly set. When using Hadoop as a file system, one would also need the <code>HADOOP_CONF_DIR</code> environment variable properly configured. This configuration is usually provided by your system administrator and is not something that you would have to manually configure.</p>
</div>
</div>
<div id="livy" class="section level3">
<h3><span class="header-section-number">6.2.4</span> Livy</h3>
<p>As opposed to other connection methods which require using an edge node in the cluster, <a href="clusters-livy">Livy</a> Livy provides a <strong>Web API</strong> that makes the Spark cluster accessible from outside the cluster and neither requires a local installation in the client. Once connected through the Web API, the <strong>Livy Service</strong> starts the Spark context by requesting reosurces from the cluster manager and distributing work as usual.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-54"></span>
<div id="htmlwidget-6af641b36df5978aa213" style="width:100%;height:480px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-6af641b36df5978aa213">{"x":{"data":null,"type":"NULL","container":"svg","options":null,"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n/* R2D3 Source File:  images/06-connections-diagram.js */\n\nsvg.append(\"svg:defs\").append(\"svg:marker\")\n  .attr(\"id\", \"circle\")\n  .attr(\"refX\", 6)\n  .attr(\"refY\", 6)\n  .attr(\"markerWidth\", 12)\n  .attr(\"markerHeight\", 12)\n  .attr(\"orient\", \"auto\")\n  .append(\"circle\")\n  .attr(\"cx\", \"6\")\n  .attr(\"cy\", \"6\")\n  .attr(\"r\", \"3\")\n  .attr(\"class\", \"block-link\")\n  .attr(\"stroke-width\", 1);\n\nfunction diagramRoot(maxWidth) {\n  if (!maxWidth) maxWidth = 500;\n\n  var scaleX = 1;\n  var scaleY = 1;\n  height = height - 20;\n\n  var newWidth = width > maxWidth ? maxWidth : width;\n  var translateX = width > newWidth ? (width - newWidth) / 2 : 0;\n  var translateY = 10;\n  width = newWidth;\n\n  svg\n    .attr(\"font-size\", Math.min(width, 500) / 600 + \"em\")\n    .attr(\"font-family\", \"sans-serif\");\n\n  var root = svg.append(\"g\")\n    .attr(\"transform\", \"translate(\" + translateX + \",\" + translateY + \")scale(\" + scaleX + \",\" + scaleY + \")\");\n\n  return root;\n}\n\nfunction drawBlock(parent, block) {\n  if (!block.x) block.x = 0;\n  if (!block.y) block.y = 0;\n  if (!block.width) block.width = blockWidth;\n  if (!block.height) block.height = blockHeight;\n  if (!block.color) block.color = \"#bbcce0\";\n  if (!block.label) block.label = \"<label>\";\n  if (!block.style) block.style = \"block\";\n\n  var startX = block.x - block.width / 2;\n  var startY = block.y - block.height / 2;\n\n  parent.append(\"rect\")\n    .attr(\"x\", startX)\n    .attr(\"y\", startY)\n    .attr(\"width\", block.width)\n    .attr(\"height\", block.height)\n    .attr(\"class\", block.style);\n\n  var current = parent.append(\"text\")\n    .attr(\"x\", block.x)\n    .attr(\"y\", startY + 20)\n    .attr(\"fill\", \"white\")\n    .attr(\"text-anchor\", \"middle\")\n    .text(block.label);\n\n  if (block.childrens) {\n    for (var childIdx in block.childrens) {\n      var child = block.childrens[childIdx];\n\n      if (!child.width) child.width = block.width - 20;\n      if (!child.x) child.x = block.x;\n      if (child.position === undefined) child.position = childIdx;\n      if (child.style === undefined) child.style = \"block-children\";\n\n      var childBlock = {\n        x: child.x,\n        y: startY + 46 + child.position * 34,\n        width: child.width,\n        height: 30,\n        label: child.label,\n        style: child.style\n      };\n\n      drawBlock(parent, childBlock);\n    }\n  }\n\n  return block;\n}\n\nfunction linkBlocks(block1, block2, label) {\n  var block1right = block1.x + block1.width / 2;\n  var block2left = block2.x - block2.width / 2;\n  var block1bottom = block1.y + block1.height / 2;\n  var block2top = block2.y - block2.height / 2;\n\n  var horizontal = block1right < block2left;\n\n  root.append('line')\n    .attr(\"x1\", horizontal ? block1right : block1.x)\n    .attr(\"y1\", horizontal ? block1.y : block1bottom)\n    .attr(\"x2\", horizontal ? block2left : block2.x)\n    .attr(\"y2\", horizontal ? block2.y : block2top)\n  \t.attr(\"class\", \"block-link\")\n  \t.attr(\"stroke-width\", \"1\")\n  \t.attr(\"marker-start\", \"url(#circle)\")\n  \t.attr(\"marker-end\", \"url(#circle)\")\n  \t.attr(\"stroke-dasharray\", \"3,7\");\n\n  var labelFits = horizontal ?\n    Math.abs(block2left - block1right) > block1.width / 2 :\n    Math.abs(block2top - block1bottom) > 30;\n\n  if (label && labelFits) {\n    root.append('text')\n      .attr(\"dy\", (horizontal ? \"-\" : \"\") + \"0.4em\")\n      .attr(\"x\", block1right + (block2left - block1right) / 2)\n      .attr(\"y\", block1bottom + (block2top - block1bottom) / 2)\n      .attr(\"text-anchor\", \"middle\")\n      .attr(\"fill\", \"#759cc7\")\n      .text(label);\n  }\n}\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  images/06-connections-livy.js */\n// !preview r2d3 dependencies=\"images/06-connections-diagram.js\", css=\"images/06-connections-diagram.css\"\n//\n// r2d3: https://rstudio.github.io/r2d3\n//\n\nvar root = diagramRoot(600);\nvar blockWidth = width / 4.0;\n\nvar totalWorkers = 3;\nvar blockHeight = height / totalWorkers - 10;\n\nvar sparklyrBlock = drawBlock(root, {\n  x: blockWidth / 2,\n  y: blockHeight / 3,\n  height: height / 4,\n  label: \"R\",\n  childrens: [{\n    label: \"sparklyr\"\n  }]\n});\n\nvar driverBlock = drawBlock(root, {\n  x: blockWidth / 2,\n  y: height / 2,\n  height: height / 3 - 10,\n  label: \"Driver\",\n  childrens: [{\n    label: \"Livy Service\"\n  }, {\n    label: \"Spark Context\"\n  }]\n});\n\nlinkBlocks(sparklyrBlock, driverBlock, \"Web API\");\n\nvar clusterBlock = drawBlock(root, {\n  x: width / 2,\n  y: height / 2,\n  height: 30,\n  label: \"Cluster Manager\"\n});\n\nlinkBlocks(driverBlock, clusterBlock);\n\nvar workers = new Array(totalWorkers);\nfor (var i = 0; i < totalWorkers; i++) {\n  workers[i] = drawBlock(root, {\n    x: width - blockWidth / 2,\n    y: 5 + blockHeight / 2 + height / totalWorkers * i,\n    height: blockHeight,\n    label: \"Worker\",\n    childrens: [{\n      label: \"Spark Executor\",\n      color: \"#759cc7\"\n    }, {\n      label: \"Spark Executor\",\n      color: \"#759cc7\"\n    }]\n  });\n}\n\nfor (var i = 0; i < workers.length; i++) {\n  linkBlocks(clusterBlock, workers[i]);\n}\n};","style":"/* R2D3 Source File:  images/06-connections-diagram.css */\n.block {\n  fill: #bbcce0;\n}\n\n.block-children {\n  fill:  #93acc7;\n}\n\n.block-link {\n  fill: white;\n  stroke: #bbcce0;\n}","version":5,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
<p class="caption">
FIGURE 6.7: Livy Connection Diagram
</p>
</div>
<p>Conencting through Livy requires the URL to the Livy service which should be similar to <code>https://hostname:port/livy</code>. Since remote connections are allowed, connections usually requires, at the very least, basic authentication:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb44-1" data-line-number="1">sc &lt;-<span class="st"> </span><span class="kw">spark_connect</span>(<span class="dt">master =</span> <span class="st">&quot;https://hostname:port/livy&quot;</span>, <span class="dt">method =</span> <span class="st">&quot;livy&quot;</span>, <span class="dt">config =</span> <span class="kw">livy_config</span>(</a>
<a class="sourceLine" id="cb44-2" data-line-number="2">  <span class="dt">username=</span><span class="st">&quot;&lt;username&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb44-3" data-line-number="3">  <span class="dt">password=</span><span class="st">&quot;&lt;password&gt;&quot;</span></a>
<a class="sourceLine" id="cb44-4" data-line-number="4">))</a></code></pre></div>
<p>Once connected through Livy, operations you can make use of an other <code>sparklyr</code> feature; however, Livy is not suitable for experimental data analysis, since executing commands have a significant delay; that said, while running long running computations, this overhead could be considered irrelevant. In general, it is preffered to avoid using Livy and work directly within an edge node in the cluster; if this is not feasible, using Livy could be a reasonable approach.</p>
</div>
<div id="mesos-1" class="section level3">
<h3><span class="header-section-number">6.2.5</span> Mesos</h3>
<p>Similar to YARN, Mesos supports client mode and a cluster mode. However, <code>sparklyr</code> currently only supports client mode for Mesos.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-56"></span>
<div id="htmlwidget-121a84c913ab8f24c101" style="width:100%;height:480px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-121a84c913ab8f24c101">{"x":{"data":null,"type":"NULL","container":"svg","options":null,"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n/* R2D3 Source File:  images/06-connections-diagram.js */\n\nsvg.append(\"svg:defs\").append(\"svg:marker\")\n  .attr(\"id\", \"circle\")\n  .attr(\"refX\", 6)\n  .attr(\"refY\", 6)\n  .attr(\"markerWidth\", 12)\n  .attr(\"markerHeight\", 12)\n  .attr(\"orient\", \"auto\")\n  .append(\"circle\")\n  .attr(\"cx\", \"6\")\n  .attr(\"cy\", \"6\")\n  .attr(\"r\", \"3\")\n  .attr(\"class\", \"block-link\")\n  .attr(\"stroke-width\", 1);\n\nfunction diagramRoot(maxWidth) {\n  if (!maxWidth) maxWidth = 500;\n\n  var scaleX = 1;\n  var scaleY = 1;\n  height = height - 20;\n\n  var newWidth = width > maxWidth ? maxWidth : width;\n  var translateX = width > newWidth ? (width - newWidth) / 2 : 0;\n  var translateY = 10;\n  width = newWidth;\n\n  svg\n    .attr(\"font-size\", Math.min(width, 500) / 600 + \"em\")\n    .attr(\"font-family\", \"sans-serif\");\n\n  var root = svg.append(\"g\")\n    .attr(\"transform\", \"translate(\" + translateX + \",\" + translateY + \")scale(\" + scaleX + \",\" + scaleY + \")\");\n\n  return root;\n}\n\nfunction drawBlock(parent, block) {\n  if (!block.x) block.x = 0;\n  if (!block.y) block.y = 0;\n  if (!block.width) block.width = blockWidth;\n  if (!block.height) block.height = blockHeight;\n  if (!block.color) block.color = \"#bbcce0\";\n  if (!block.label) block.label = \"<label>\";\n  if (!block.style) block.style = \"block\";\n\n  var startX = block.x - block.width / 2;\n  var startY = block.y - block.height / 2;\n\n  parent.append(\"rect\")\n    .attr(\"x\", startX)\n    .attr(\"y\", startY)\n    .attr(\"width\", block.width)\n    .attr(\"height\", block.height)\n    .attr(\"class\", block.style);\n\n  var current = parent.append(\"text\")\n    .attr(\"x\", block.x)\n    .attr(\"y\", startY + 20)\n    .attr(\"fill\", \"white\")\n    .attr(\"text-anchor\", \"middle\")\n    .text(block.label);\n\n  if (block.childrens) {\n    for (var childIdx in block.childrens) {\n      var child = block.childrens[childIdx];\n\n      if (!child.width) child.width = block.width - 20;\n      if (!child.x) child.x = block.x;\n      if (child.position === undefined) child.position = childIdx;\n      if (child.style === undefined) child.style = \"block-children\";\n\n      var childBlock = {\n        x: child.x,\n        y: startY + 46 + child.position * 34,\n        width: child.width,\n        height: 30,\n        label: child.label,\n        style: child.style\n      };\n\n      drawBlock(parent, childBlock);\n    }\n  }\n\n  return block;\n}\n\nfunction linkBlocks(block1, block2, label) {\n  var block1right = block1.x + block1.width / 2;\n  var block2left = block2.x - block2.width / 2;\n  var block1bottom = block1.y + block1.height / 2;\n  var block2top = block2.y - block2.height / 2;\n\n  var horizontal = block1right < block2left;\n\n  root.append('line')\n    .attr(\"x1\", horizontal ? block1right : block1.x)\n    .attr(\"y1\", horizontal ? block1.y : block1bottom)\n    .attr(\"x2\", horizontal ? block2left : block2.x)\n    .attr(\"y2\", horizontal ? block2.y : block2top)\n  \t.attr(\"class\", \"block-link\")\n  \t.attr(\"stroke-width\", \"1\")\n  \t.attr(\"marker-start\", \"url(#circle)\")\n  \t.attr(\"marker-end\", \"url(#circle)\")\n  \t.attr(\"stroke-dasharray\", \"3,7\");\n\n  var labelFits = horizontal ?\n    Math.abs(block2left - block1right) > block1.width / 2 :\n    Math.abs(block2top - block1bottom) > 30;\n\n  if (label && labelFits) {\n    root.append('text')\n      .attr(\"dy\", (horizontal ? \"-\" : \"\") + \"0.4em\")\n      .attr(\"x\", block1right + (block2left - block1right) / 2)\n      .attr(\"y\", block1bottom + (block2top - block1bottom) / 2)\n      .attr(\"text-anchor\", \"middle\")\n      .attr(\"fill\", \"#759cc7\")\n      .text(label);\n  }\n}\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  images/06-connections-mesos.js */\n// !preview r2d3 dependencies=\"images/06-connections-diagram.js\", css=\"images/06-connections-diagram.css\"\n//\n// r2d3: https://rstudio.github.io/r2d3\n//\n\nvar root = diagramRoot(600);\nvar blockWidth = width / 4.0;\n\nvar totalWorkers = 3;\nvar blockHeight = height / totalWorkers - 10;\n\nvar driverBlock = drawBlock(root, {\n  x: blockWidth / 2,\n  y: height / 2,\n  height: 150,\n  label: \"Driver\",\n  childrens: [{\n    label: \"R\"\n  }, {\n    label: \"sparklyr\"\n  }, {\n    label: \"Spark Context\"\n  }]\n});\n\nvar clusterBlock = drawBlock(root, {\n  x: width / 2,\n  y: height / 2,\n  height: 80,\n  label: \"Cluster Manager\",\n  childrens: [{\n    label: \"Mesos\"\n  }]\n});\n\nvar workers = new Array(totalWorkers);\nfor (var i = 0; i < totalWorkers; i++) {\n  workers[i] = drawBlock(root, {\n    x: width - blockWidth / 2,\n    y: 5 + blockHeight / 2 + height / totalWorkers * i,\n    height: blockHeight,\n    label: \"Worker\",\n    childrens: [{\n      label: \"Spark Executor\",\n      color: \"#759cc7\"\n    }, {\n      label: \"Spark Executor\",\n      color: \"#759cc7\"\n    }]\n  });\n}\n\nlinkBlocks(driverBlock, clusterBlock);\nfor (var i = 0; i < workers.length; i++) {\n  linkBlocks(clusterBlock, workers[i]);\n}\n};","style":"/* R2D3 Source File:  images/06-connections-diagram.css */\n.block {\n  fill: #bbcce0;\n}\n\n.block-children {\n  fill:  #93acc7;\n}\n\n.block-link {\n  fill: white;\n  stroke: #bbcce0;\n}","version":5,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
<p class="caption">
FIGURE 6.8: Mesos Connection Diagram
</p>
</div>
<p>Connecting requires the address to the Mesos master node, usually in the form of <code>mesos://host:port</code> or <code>mesos://zk://host1:2181,host2:2181,host3:2181/mesos</code> for Mesos using ZooKeeper.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" data-line-number="1">sc &lt;-<span class="st"> </span><span class="kw">spark_connect</span>(<span class="dt">master =</span> <span class="st">&quot;mesos://host:port&quot;</span>)</a></code></pre></div>
</div>
<div id="kubernetes-1" class="section level3">
<h3><span class="header-section-number">6.2.6</span> Kubernetes</h3>
<p>Kubernetes cluster do not support client modes similar to Mesos or YARN, instead, the connection model is similar to YARN Cluster, where the driver node is assigned by Kubernetes.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-58"></span>
<div id="htmlwidget-5eefb0713b86dd544aa4" style="width:100%;height:480px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-5eefb0713b86dd544aa4">{"x":{"data":null,"type":"NULL","container":"svg","options":null,"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n/* R2D3 Source File:  images/06-connections-diagram.js */\n\nsvg.append(\"svg:defs\").append(\"svg:marker\")\n  .attr(\"id\", \"circle\")\n  .attr(\"refX\", 6)\n  .attr(\"refY\", 6)\n  .attr(\"markerWidth\", 12)\n  .attr(\"markerHeight\", 12)\n  .attr(\"orient\", \"auto\")\n  .append(\"circle\")\n  .attr(\"cx\", \"6\")\n  .attr(\"cy\", \"6\")\n  .attr(\"r\", \"3\")\n  .attr(\"class\", \"block-link\")\n  .attr(\"stroke-width\", 1);\n\nfunction diagramRoot(maxWidth) {\n  if (!maxWidth) maxWidth = 500;\n\n  var scaleX = 1;\n  var scaleY = 1;\n  height = height - 20;\n\n  var newWidth = width > maxWidth ? maxWidth : width;\n  var translateX = width > newWidth ? (width - newWidth) / 2 : 0;\n  var translateY = 10;\n  width = newWidth;\n\n  svg\n    .attr(\"font-size\", Math.min(width, 500) / 600 + \"em\")\n    .attr(\"font-family\", \"sans-serif\");\n\n  var root = svg.append(\"g\")\n    .attr(\"transform\", \"translate(\" + translateX + \",\" + translateY + \")scale(\" + scaleX + \",\" + scaleY + \")\");\n\n  return root;\n}\n\nfunction drawBlock(parent, block) {\n  if (!block.x) block.x = 0;\n  if (!block.y) block.y = 0;\n  if (!block.width) block.width = blockWidth;\n  if (!block.height) block.height = blockHeight;\n  if (!block.color) block.color = \"#bbcce0\";\n  if (!block.label) block.label = \"<label>\";\n  if (!block.style) block.style = \"block\";\n\n  var startX = block.x - block.width / 2;\n  var startY = block.y - block.height / 2;\n\n  parent.append(\"rect\")\n    .attr(\"x\", startX)\n    .attr(\"y\", startY)\n    .attr(\"width\", block.width)\n    .attr(\"height\", block.height)\n    .attr(\"class\", block.style);\n\n  var current = parent.append(\"text\")\n    .attr(\"x\", block.x)\n    .attr(\"y\", startY + 20)\n    .attr(\"fill\", \"white\")\n    .attr(\"text-anchor\", \"middle\")\n    .text(block.label);\n\n  if (block.childrens) {\n    for (var childIdx in block.childrens) {\n      var child = block.childrens[childIdx];\n\n      if (!child.width) child.width = block.width - 20;\n      if (!child.x) child.x = block.x;\n      if (child.position === undefined) child.position = childIdx;\n      if (child.style === undefined) child.style = \"block-children\";\n\n      var childBlock = {\n        x: child.x,\n        y: startY + 46 + child.position * 34,\n        width: child.width,\n        height: 30,\n        label: child.label,\n        style: child.style\n      };\n\n      drawBlock(parent, childBlock);\n    }\n  }\n\n  return block;\n}\n\nfunction linkBlocks(block1, block2, label) {\n  var block1right = block1.x + block1.width / 2;\n  var block2left = block2.x - block2.width / 2;\n  var block1bottom = block1.y + block1.height / 2;\n  var block2top = block2.y - block2.height / 2;\n\n  var horizontal = block1right < block2left;\n\n  root.append('line')\n    .attr(\"x1\", horizontal ? block1right : block1.x)\n    .attr(\"y1\", horizontal ? block1.y : block1bottom)\n    .attr(\"x2\", horizontal ? block2left : block2.x)\n    .attr(\"y2\", horizontal ? block2.y : block2top)\n  \t.attr(\"class\", \"block-link\")\n  \t.attr(\"stroke-width\", \"1\")\n  \t.attr(\"marker-start\", \"url(#circle)\")\n  \t.attr(\"marker-end\", \"url(#circle)\")\n  \t.attr(\"stroke-dasharray\", \"3,7\");\n\n  var labelFits = horizontal ?\n    Math.abs(block2left - block1right) > block1.width / 2 :\n    Math.abs(block2top - block1bottom) > 30;\n\n  if (label && labelFits) {\n    root.append('text')\n      .attr(\"dy\", (horizontal ? \"-\" : \"\") + \"0.4em\")\n      .attr(\"x\", block1right + (block2left - block1right) / 2)\n      .attr(\"y\", block1bottom + (block2top - block1bottom) / 2)\n      .attr(\"text-anchor\", \"middle\")\n      .attr(\"fill\", \"#759cc7\")\n      .text(label);\n  }\n}\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  images/06-connections-kubernetes.js */\n// !preview r2d3 dependencies=\"images/06-connections-diagram.js\", css=\"images/06-connections-diagram.css\"\n//\n// r2d3: https://rstudio.github.io/r2d3\n//\n\nvar root = diagramRoot(600);\nvar blockWidth = width / 4.0;\n\nvar totalWorkers = 3;\nvar blockHeight = height / totalWorkers - 10;\n\nvar sparklyrBlock = drawBlock(root, {\n  x: blockWidth / 2,\n  y: blockHeight / 3,\n  height: height / 4,\n  label: \"R\",\n  childrens: [{\n    label: \"sparklyr\"\n  }]\n});\n\nvar driverBlock = drawBlock(root, {\n  x: blockWidth / 2,\n  y: height / 2,\n  height: height / 4,\n  label: \"Driver\",\n  childrens: [{\n    label: \"Spark Context\"\n  }]\n});\n\nvar clusterBlock = drawBlock(root, {\n  x: width / 2,\n  y: height / 2,\n  height: 80,\n  label: \"Cluster Manager\",\n  childrens: [{\n    label: \"Kubernetes\"\n  }]\n});\n\nlinkBlocks(sparklyrBlock, clusterBlock);\nlinkBlocks(driverBlock, clusterBlock);\n\nvar workers = new Array(totalWorkers);\nfor (var i = 0; i < totalWorkers; i++) {\n  workers[i] = drawBlock(root, {\n    x: width - blockWidth / 2,\n    y: 5 + blockHeight / 2 + height / totalWorkers * i,\n    height: blockHeight,\n    label: \"Worker\",\n    childrens: [{\n      label: \"Spark Executor\",\n      color: \"#759cc7\"\n    }, {\n      label: \"Spark Executor\",\n      color: \"#759cc7\"\n    }]\n  });\n}\n\nfor (var i = 0; i < workers.length; i++) {\n  linkBlocks(clusterBlock, workers[i]);\n}\n};","style":"/* R2D3 Source File:  images/06-connections-diagram.css */\n.block {\n  fill: #bbcce0;\n}\n\n.block-children {\n  fill:  #93acc7;\n}\n\n.block-link {\n  fill: white;\n  stroke: #bbcce0;\n}","version":5,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
<p class="caption">
FIGURE 6.9: Kubernetes Connection Diagram
</p>
</div>
<p>Kubernetes support is scheduled to be added to <code>sparklyr</code> with <a href="https://github.com/rstudio/sparklyr/issues/1525">sparklyr/issues/1525</a>, please follow progress for this feature directly in github. Once Kubernetes becomes supported in <code>sparklyr</code>, connecting to Kubernetes will work as follows:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb46-1" data-line-number="1">sc &lt;-<span class="st"> </span><span class="kw">spark_connect</span>(</a>
<a class="sourceLine" id="cb46-2" data-line-number="2">  <span class="dt">master =</span> <span class="st">&quot;k8s://https://&lt;apiserver-host&gt;:&lt;apiserver-port&gt;&quot;</span></a>
<a class="sourceLine" id="cb46-3" data-line-number="3">  <span class="dt">config =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb46-4" data-line-number="4">    <span class="dt">spark.executor.instances =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb46-5" data-line-number="5">    <span class="dt">spark.kubernetes.container.image =</span> <span class="st">&quot;spark-image&quot;</span></a>
<a class="sourceLine" id="cb46-6" data-line-number="6">  )</a>
<a class="sourceLine" id="cb46-7" data-line-number="7">)</a></code></pre></div>
<p>If your computer is already configured to use a Kubernetes cluster, you can use the following commmand to find the <code>apiserver-host</code> and <code>apiserver-port</code>:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb47-1" data-line-number="1"><span class="kw">system2</span>(<span class="st">&quot;kubectl&quot;</span>, <span class="st">&quot;cluster-info&quot;</span>)</a></code></pre></div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="overview-3.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="troubleshooting.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
